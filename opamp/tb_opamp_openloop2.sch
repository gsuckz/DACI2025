v {xschem version=3.4.6 file_version=1.2}
G {}
K {}
V {}
S {}
E {}
N 1130 -140 1130 -100 { lab=GND}
N 1130 -240 1130 -200 { lab=vss}
N 1220 -240 1220 -200 { lab=vdd}
N 1220 -140 1220 -100 { lab=vss}
N 1530 -250 1530 -210 { lab=vss}
N 1320 -340 1320 -300 { lab=vin}
N 1630 -250 1630 -210 { lab=vss}
N 1320 -240 1320 -200 { lab=vsen}
N 1320 -140 1320 -100 { lab=vcm}
N 1210 -430 1340 -430 { lab=ve}
N 1280 -620 1340 -620 { lab=ve}
N 1270 -620 1270 -430 { lab=ve}
N 1270 -620 1280 -620 { lab=ve}
N 1090 -430 1150 -430 { lab=vcm}
N 1400 -430 1450 -430 { lab=vin}
N 1450 -430 1510 -430 { lab=vin}
N 1450 -320 1450 -280 { lab=vss}
N 1450 -430 1450 -380 { lab=vin}
N 1630 -350 1630 -310 { lab=iref}
N 1780 -410 1780 -390 { lab=vout}
N 1730 -410 1780 -410 { lab=vout}
N 1780 -330 1780 -300 { lab=vss}
N 1540 -390 1590 -390 { lab=vcm}
N 1530 -390 1530 -310 { lab=vcm}
N 1530 -390 1540 -390 { lab=vcm}
N 1510 -430 1590 -430 { lab=vin}
N 1590 -620 1780 -620 { lab=vout}
N 1780 -620 1780 -410 { lab=vout}
N 1340 -620 1530 -620 { lab=ve}
N 1650 -510 1650 -460 {
lab=vdd}
N 1670 -370 1670 -320 {
lab=vss}
N 2230 -115 2230 -40 { lab=#net1}
N 2510 -115 2510 -40 { lab=#net1}
N 2230 -40 2297.5 -40 { lab=#net1}
N 2297.5 -40 2510 -40 { lab=#net1}
N 2310 -215 2310 -145 { lab=vbn}
N 2150 -145 2230 -145 { lab=#net1}
N 2150 -145 2150 -40 { lab=#net1}
N 2150 -40 2230 -40 { lab=#net1}
N 2510 -145 2577.5 -145 { lab=#net1}
N 2577.5 -145 2577.5 -40 { lab=#net1}
N 2510 -320 2510 -175 { lab=voe1}
N 2230 -440 2230 -380 { lab=vp}
N 2230 -440 2510 -440 { lab=vp}
N 2510 -440 2510 -380 { lab=vp}
N 2227.5 -350 2290 -350 { lab=vp}
N 2290 -440 2290 -350 { lab=vp}
N 2447.5 -440 2447.5 -350 { lab=vp}
N 2370 -490 2370 -440 { lab=vp}
N 2830 -552.5 2830 -550 { lab=vdd}
N 2830 -580 2830 -552.5 { lab=vdd}
N 2370 -580 2830 -580 { lab=vdd}
N 2370 -580 2370 -550 { lab=vdd}
N 2827.5 -520 2907.5 -520 { lab=vdd}
N 2907.5 -580 2907.5 -520 { lab=vdd}
N 2830 -580 2907.5 -580 { lab=vdd}
N 1990 -580 1990 -550 { lab=vdd}
N 1990 -580 2370 -580 { lab=vdd}
N 1990 -440 2092.5 -440 { lab=iref}
N 2092.5 -520 2092.5 -440 { lab=iref}
N 2707.5 -520 2790 -520 { lab=iref}
N 1910 -520 1992.5 -520 { lab=vdd}
N 1910 -580 1910 -520 { lab=vdd}
N 1910 -580 1990 -580 { lab=vdd}
N 2370 -520 2450 -520 { lab=vdd}
N 2450 -580 2450 -520 { lab=vdd}
N 2310 -217.5 2310 -215 { lab=vbn}
N 2447.5 -350 2512.5 -350 { lab=vp}
N 2230 -320 2230 -175 { lab=vbn}
N 2230 -217.5 2310 -217.5 { lab=vbn}
N 2030 -520 2092.5 -520 { lab=iref}
N 2215 -520 2330 -520 { lab=iref}
N 2092.5 -520 2215 -520 { lab=iref}
N 2270 -145 2470 -145 { lab=vbn}
N 1990 -490 1990 -440 { lab=iref}
N 2120 -350 2190 -350 { lab=vin}
N 2690 -270 2740 -270 { lab=#net2}
N 2660 -330 2660 -310 { lab=vdd}
N 2510 -270 2630 -270 { lab=voe1}
N 2800 -270 2830 -270 { lab=vout}
N 1890 -580 1910 -580 { lab=vdd}
N 2550 -350 2610 -350 { lab=vcm}
N 1890 -440 1990 -440 { lab=iref}
N 2510 -40 2830 -40 { lab=#net1}
N 2830 -40 2920 -40 { lab=#net1}
N 2920 -140 2920 -40 { lab=#net1}
N 2830 -140 2920 -140 { lab=#net1}
N 2610 -140 2790 -140 { lab=voe1}
N 2610 -270 2610 -140 { lab=voe1}
N 2830 -270 2830 -170 { lab=vout}
N 2830 -490 2830 -270 { lab=vout}
N 2830 -320 2970 -320 { lab=vout}
N 2830 -110 2830 -40 { lab=#net1}
N 1960 -100 2070 -100 {lab=#net1}
N 2070 -100 2150 -100 {lab=#net1}
N 1890 -40 1960 -40 {lab=vss}
C {vsource.sym} 1130 -170 0 0 {name=V1 value=DC\{vss\}}
C {vsource.sym} 1220 -170 0 0 {name=V2 value=DC\{vdd\}}
C {vsource.sym} 1530 -280 0 0 {name=V3 value=DC\{vcm\}}
C {gnd.sym} 1130 -100 0 0 {name=l14 lab=GND}
C {vsource.sym} 1320 -170 0 0 {name=V4 value="sin(0 \{vac\} \{fin\}) dc 0 ac 1"}
C {capa.sym} 1320 -270 2 0 {name=C4
m=1
value=1
footprint=1206
device="ceramic capacitor"}
C {lab_pin.sym} 1220 -240 1 0 {name=l15 sig_type=std_logic lab=vdd}
C {lab_pin.sym} 1130 -240 1 0 {name=l16 sig_type=std_logic lab=vss}
C {lab_pin.sym} 1220 -100 3 0 {name=l18 sig_type=std_logic lab=vss}
C {lab_pin.sym} 1530 -210 3 0 {name=l19 sig_type=std_logic lab=vss}
C {lab_pin.sym} 1320 -100 3 0 {name=l20 sig_type=std_logic lab=vcm}
C {lab_pin.sym} 1320 -340 1 0 {name=l21 sig_type=std_logic lab=vin}
C {isource.sym} 1630 -280 0 0 {name=I0 value=DC\{iref\}}
C {lab_pin.sym} 1630 -210 3 0 {name=l22 sig_type=std_logic lab=vss}
C {lab_wire.sym} 1320 -230 3 0 {name=l24 sig_type=std_logic lab=vsen}
C {res.sym} 1180 -430 1 0 {name=R1
value=500
footprint=1206
device=resistor
m=1}
C {res.sym} 1560 -620 1 0 {name=R3
value=5k
footprint=1206
device=resistor
m=1}
C {lab_pin.sym} 1090 -430 0 0 {name=l25 sig_type=std_logic lab=vcm}
C {lab_wire.sym} 1250 -430 0 0 {name=l26 sig_type=std_logic lab=ve

}
C {lab_pin.sym} 1450 -280 3 0 {name=l28 sig_type=std_logic lab=vss
}
C {capa.sym} 1450 -350 0 0 {name=C5
m=1
value=3p
footprint=1206
device="ceramic capacitor"}
C {netlist_not_shown.sym} 1080 -610 0 0 {name=SIMULATION only_toplevel=false 

value="


* Circuit Parameters
.param iref = 100u
.param vdd  = 1.8
.param vss  = 0.0
.param vcm  = 0.8
.param vac  = 10m
.param fin  = 9.765625e5
.options TEMP = 65.0

* Include Models
*.lib ~/skywater/skywater-pdk/libraries/sky130_fd_pr_ngspice/latest/models/corners/sky130.lib TT
*.lib /foss/pdks/sky130A/libs.tech/ngspice/sky130.lib.spice tt
.lib /foss/pdks/sky130A/libs.tech/ngspice/sky130.lib.spice.tt.red tt
* OP Parameters & Singals to save
.save all
+ @M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[id] @M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[vth] @M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[vgs] @M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[vds] @M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[vdsat] @M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[gm] @M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[gds]
+ @M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[id] @M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[vth] @M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[vgs] @M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[vds] @M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[vdsat] @M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[gm] @M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[gds]
+ @M.X1.XM3.msky130_fd_pr__nfet_01v8[id] @M.X1.XM3.msky130_fd_pr__nfet_01v8[vth] @M.X1.XM3.msky130_fd_pr__nfet_01v8[vgs] @M.X1.XM3.msky130_fd_pr__nfet_01v8[vds] @M.X1.XM3.msky130_fd_pr__nfet_01v8[vdsat] @M.X1.XM3.msky130_fd_pr__nfet_01v8[gm] @M.X1.XM3.msky130_fd_pr__nfet_01v8[gds]
+ @M.X1.XM4.msky130_fd_pr__nfet_01v8[id] @M.X1.XM4.msky130_fd_pr__nfet_01v8[vth] @M.X1.XM4.msky130_fd_pr__nfet_01v8[vgs] @M.X1.XM4.msky130_fd_pr__nfet_01v8[vds] @M.X1.XM4.msky130_fd_pr__nfet_01v8[vdsat] @M.X1.XM4.msky130_fd_pr__nfet_01v8[gm] @M.X1.XM4.msky130_fd_pr__nfet_01v8[gds]
+ @M.X1.XM5.msky130_fd_pr__pfet_01v8[id] @M.X1.XM5.msky130_fd_pr__pfet_01v8[vth] @M.X1.XM5.msky130_fd_pr__pfet_01v8[vgs] @M.X1.XM5.msky130_fd_pr__pfet_01v8[vds] @M.X1.XM5.msky130_fd_pr__pfet_01v8[vdsat] @M.X1.XM5.msky130_fd_pr__pfet_01v8[gm] @M.X1.XM5.msky130_fd_pr__pfet_01v8[gds]
+ @M.X1.XM6.msky130_fd_pr__nfet_01v8[id] @M.X1.XM6.msky130_fd_pr__nfet_01v8[vth] @M.X1.XM6.msky130_fd_pr__nfet_01v8[vgs] @M.X1.XM6.msky130_fd_pr__nfet_01v8[vds] @M.X1.XM6.msky130_fd_pr__nfet_01v8[vdsat] @M.X1.XM6.msky130_fd_pr__nfet_01v8[gm] @M.X1.XM6.msky130_fd_pr__nfet_01v8[gds]
+ @M.X1.XM7.msky130_fd_pr__pfet_01v8[id] @M.X1.XM7.msky130_fd_pr__pfet_01v8[vth] @M.X1.XM7.msky130_fd_pr__pfet_01v8[vgs] @M.X1.XM7.msky130_fd_pr__pfet_01v8[vds] @M.X1.XM7.msky130_fd_pr__pfet_01v8[vdsat] @M.X1.XM7.msky130_fd_pr__pfet_01v8[gm] @M.X1.XM7.msky130_fd_pr__pfet_01v8[gds]
+ @M.X1.XM8.msky130_fd_pr__pfet_01v8[id] @M.X1.XM8.msky130_fd_pr__pfet_01v8[vth] @M.X1.XM8.msky130_fd_pr__pfet_01v8[vgs] @M.X1.XM8.msky130_fd_pr__pfet_01v8[vds] @M.X1.XM8.msky130_fd_pr__pfet_01v8[vdsat] @M.X1.XM8.msky130_fd_pr__pfet_01v8[gm] @M.X1.XM8.msky130_fd_pr__pfet_01v8[gds]
+ @M.X1.XM9.msky130_fd_pr__nfet_01v8[id] @M.X1.XM9.msky130_fd_pr__nfet_01v8[vth] @M.X1.XM9.msky130_fd_pr__nfet_01v8[vgs] @M.X1.XM9.msky130_fd_pr__nfet_01v8[vds] @M.X1.XM9.msky130_fd_pr__nfet_01v8[vdsat] @M.X1.XM9.msky130_fd_pr__nfet_01v8[gm] @M.X1.XM9.msky130_fd_pr__nfet_01v8[gds]

*Simulation
.control
  set color0 = white

  ac dec 100 1 10G
  setplot ac1
  meas ac GBW when vdb(vout)=0
  meas ac DCG find vdb(vout) at=1
  meas ac PM find vp(vout) when vdb(vout)=0
  print PM*180/PI
  meas ac GM find vdb(vout) when vp(vout)=0
  plot vdb(vout) \{vp(vout)*180/PI\}
  plot vdb(voe1) \{vp(voe1)*180/PI\}
  write tb_opamp_openloop_ac2.raw

  reset
  op
  setplot op1
  unset filetype
  write tb_opamp_openloop2.raw
.endc

.end
"}
C {capa.sym} 1780 -360 0 0 {name=C1
m=1
value=20p
footprint=1206
device="ceramic capacitor"}
C {lab_pin.sym} 1780 -300 3 0 {name=l2 sig_type=std_logic lab=vss}
C {lab_wire.sym} 1770 -410 0 0 {name=l3 sig_type=std_logic lab=vout

}
C {lab_wire.sym} 1570 -390 0 0 {name=l5 sig_type=std_logic lab=vcm

}
C {lab_wire.sym} 1520 -430 0 0 {name=l6 sig_type=std_logic lab=vin

}
C {ngspice_probe.sym} 1780 -410 0 0 {name=r1}
C {lab_pin.sym} 1650 -500 2 0 {name=l1 sig_type=std_logic lab=vdd}
C {lab_pin.sym} 1670 -340 2 0 {name=l4 sig_type=std_logic lab=vss}
C {ngspice_probe.sym} 1630 -330 2 0 {name=r2}
C {ngspice_probe.sym} 1520 -430 2 0 {name=r3}
C {ngspice_probe.sym} 1580 -390 2 0 {name=r4}
C {ngspice_probe.sym} 1270 -480 0 0 {name=r5}
C {res.sym} 1370 -430 1 0 {name=R6
value=10G
footprint=1206
device=resistor
m=1}
C {sky130_fd_pr/nfet_01v8.sym} 2250 -145 0 1 {name=M3
L=0.4
W=6
ad="'W * 0.29'" pd="'2 * (W + 0.29)'"
as="'W * 0.29'" ps="'2 * (W + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
nf=1 mult=1
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8.sym} 2490 -145 0 0 {name=M4
L=0.4
W=6
ad="'W * 0.29'" pd="'2 * (W + 0.29)'"
as="'W * 0.29'" ps="'2 * (W + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
nf=1 mult=1
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2350 -520 0 0 {name=M5
L=0.3
W=30
ad="'W * 0.29'" pd="'2 * (W + 0.29)'"
as="'W * 0.29'" ps="'2 * (W + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
nf=1 mult=1
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2810 -520 0 0 {name=M7
L=0.3
W=35
ad="'W * 0.29'" pd="'2 * (W + 0.29)'"
as="'W * 0.29'" ps="'2 * (W + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
nf=1 mult=14
model=pfet_01v8
spiceprefix=X}
C {sky130_fd_pr/pfet_01v8.sym} 2010 -520 0 1 {name=M8
L=0.3
W=40
ad="'W * 0.29'" pd="'2 * (W + 0.29)'"
as="'W * 0.29'" ps="'2 * (W + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
nf=1 mult=1
model=pfet_01v8
spiceprefix=X
}
C {lab_wire.sym} 2212.5 -580 0 0 {name=l7 sig_type=std_logic lab=vdd
}
C {lab_wire.sym} 2195 -520 0 0 {name=l8 sig_type=std_logic lab=iref

}
C {lab_wire.sym} 2355 -440 0 0 {name=l9 sig_type=std_logic lab=vp}
C {lab_pin.sym} 2707.5 -520 0 0 {name=l10 sig_type=std_logic lab=iref}
C {lab_wire.sym} 2877.5 -320 0 0 {name=l11 sig_type=std_logic lab=vout
}
C {lab_wire.sym} 2390 -145 0 0 {name=l12 sig_type=std_logic lab=vbn}
C {lab_pin.sym} 2660 -320 2 0 {name=l13 sig_type=std_logic lab=vdd
}
C {lab_pin.sym} 2660 -190 2 0 {name=l17 sig_type=std_logic lab=vss
}
C {sky130_fd_pr/nfet_01v8.sym} 2810 -140 0 0 {name=M6
L=0.4
W=8
ad="'W * 0.29'" pd="'2 * (W + 0.29)'"
as="'W * 0.29'" ps="'2 * (W + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
nf=1 mult=40
model=nfet_01v8
spiceprefix=X}
C {lab_wire.sym} 2570 -270 0 0 {name=l23 sig_type=std_logic lab=voe1}
C {ngspice_get_value.sym} 2230 -410 0 0 {name=r7 node=i(@M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[id])
descr="I= "}
C {ngspice_probe.sym} 2230 -260 0 0 {name=r8}
C {ngspice_probe.sym} 2290 -440 0 0 {name=r9}
C {ngspice_probe.sym} 2510 -240 0 0 {name=r10}
C {ngspice_probe.sym} 2720 -140 0 0 {name=r11}
C {ngspice_get_value.sym} 2230 -200 0 0 {name=r12 node=i(@M.X1.XM3.msky130_fd_pr__nfet_01v8[id])
descr="I= "}
C {ngspice_get_value.sym} 2510 -200 0 0 {name=r13 node=i(@M.X1.XM4.msky130_fd_pr__nfet_01v8[id])
descr="I= "}
C {ngspice_get_value.sym} 2830 -200 0 0 {name=r14 node=i(@M.X1.XM6.msky130_fd_pr__nfet_01v8[id])
descr="I= "}
C {ngspice_get_value.sym} 2510 -410 0 0 {name=r15 node=i(@M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[id])
descr="I= "}
C {ngspice_get_value.sym} 2890 -450 0 0 {name=r16 node=i(@M.X1.XM7.msky130_fd_pr__pfet_01v8[id])
descr="I= "}
C {ngspice_get_value.sym} 2370 -460 0 0 {name=r17 node=i(@M.X1.XM5.msky130_fd_pr__pfet_01v8[id])
descr="I= "}
C {ngspice_get_value.sym} 1990 -460 0 0 {name=r18 node=i(@M.X1.XM8.msky130_fd_pr__pfet_01v8[id])
descr="I= "}
C {ngspice_get_value.sym} 2230 -380 0 0 {name=r19 node=@M.X1.XM1.msky130_fd_pr__pfet_01v8_lvt[gm]
descr="gm= "}
C {launcher.sym} 1940 -250 0 0 {name=h1
descr=Annotate 
tclcommand="ngspice::annotate"}
C {ngspice_get_value.sym} 2510 -380 0 0 {name=r20 node=@M.X1.XM2.msky130_fd_pr__pfet_01v8_lvt[gm]
descr="gm= "}
C {ngspice_get_value.sym} 2230 -170 0 0 {name=r21 node=@M.X1.XM3.msky130_fd_pr__nfet_01v8[gm]
descr="gm= "}
C {ngspice_get_value.sym} 2510 -170 0 0 {name=r22 node=@M.X1.XM4.msky130_fd_pr__nfet_01v8[gm]
descr="gm= "}
C {ngspice_get_value.sym} 2830 -170 0 0 {name=r23 node=@M.X1.XM6.msky130_fd_pr__nfet_01v8[gm]
descr="gm= "}
C {ngspice_get_value.sym} 2890 -420 0 0 {name=r24 node=@M.X1.XM7.msky130_fd_pr__pfet_01v8[vdsat]
descr="gm= "}
C {ngspice_get_value.sym} 2470 -520 0 0 {name=r25 node=@M.X1.XM5.msky130_fd_pr__pfet_01v8[gm]
descr="gm= "}
C {ngspice_get_value.sym} 2030 -520 0 0 {name=r26 node=@M.X1.XM8.msky130_fd_pr__pfet_01v8[gm]
descr="gm= "}
C {ngspice_probe.sym} 2690 -270 0 0 {name=r27}
C {sky130_fd_pr/pfet_01v8_lvt.sym} 2210 -350 0 0 {name=M1
L=.8
W=6
nf=1
mult=10
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8_lvt.sym} 2530 -350 0 1 {name=M2
L=.8
W=6
nf=1
mult=10
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {capa.sym} 2770 -270 3 0 {name=C2
m=1
value=.4p
footprint=1206
device="ceramic capacitor"}
C {ammeter.sym} 1960 -70 0 0 {name=Vmeas savecurrent=true spice_ignore=0}
C {ngspice_get_value.sym} 2470 -490 0 0 {name=r28 node=@M.X1.XM5.msky130_fd_pr__pfet_01v8[vth]
descr="vth= "}
C {res.sym} 2660 -270 1 0 {name=R29
value=1.8k
footprint=1206
device=resistor
m=1}
C {lab_wire.sym} 2145 -350 0 0 {name=l30 sig_type=std_logic lab=vin

}
C {lab_pin.sym} 1890 -40 3 0 {name=l31 sig_type=std_logic lab=vss}
C {lab_wire.sym} 2610 -350 0 0 {name=l32 sig_type=std_logic lab=vcm

}
C {lab_wire.sym} 1630 -350 0 0 {name=l27 sig_type=std_logic lab=iref

}
